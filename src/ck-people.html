<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="shared-styles.html">

<dom-module id="ck-people">
  <template>
    <style include="shared-styles">
      paper-button[raised]{background-color:var(--cricket-primary-accent-color);color: white;}
      iron-icon{margin-right:12px;}
      .row{flex-wrap:wrap;}
    </style>
    <div class="row">
      <template is="dom-repeat" items="{{people}}">
        <div class="card">[[item.name]] ([[item.wins]] victoires)</div>
      </template>
    </div>
    <div class="card row">
      <paper-input class="flex" type="text" id="new" label="Nom d'un nouveau joueur"></paper-input>
      <paper-button raised on-click="_addPeople"><iron-icon icon="ck:new-people"></iron-icon>Ajouter</paper-button>
      <paper-button on-click="_clearPeople"><iron-icon icon="ck:delete"></iron-icon>Effacer tout</paper-button>
    </div>
  </template>
  <script>
    class CkPeople extends Polymer.Element {
      static get is() { return 'ck-people';}
      static get properties() {
        return {
          people: {
            type: Array,
            notify: true
          }
        };
      }
      _addPeople(e){
        this.$.new.set('invalid',false);
        if(this.$.new.value){
          var exists = false;
          for(var i = 0; i < this.people.length; i++){
            if(this.people[i].name === this.$.new.value){exists = true;break;}
          }
          if(exists){
            this.$.new.set('errorMessage','Ce nom existe déjà !');
            this.$.new.set('invalid',true);
          }
          else{
            var newP = {name:this.$.new.value,wins:0,plays:0,playing:false};
            if(!this.people){
              this.set('people',[newP]);
            }
            else{this.push('people',newP)};
            this.$.new.$.input.value = '';
            this.$.new.set('value','');
            this.$.new.focus();
          }
        }
        else{
          this.$.new.set('errorMessage','Donne un nom au nouveau joueur !');
          this.$.new.set('invalid',true);
        }
      }
      _clearPeople(e){
        this.set('people',[]);
      }
    }
    window.customElements.define(CkPeople.is, CkPeople);
  </script>
</dom-module>